{"version":3,"file":"script.js","sources":["script.es6.js"],"sourcesContent":["/**\n * @typedef SmartFilterStationCheckbox\n * @type {object}\n * @property {string} [CHECKED] Станция выбрана\n * @property {string} [DISABLED] Станция не может быть выбрана (не будет результата фильтрации с учетом других критериев)\n * @property {string} CONTROL_ID\n * @property {string} CONTROL_NAME\n * @property {string} CONTROL_NAME_ALT\n * @property {string} HTML_VALUE\n * @property {string} HTML_VALUE_ALT\n * @property {string} VALUE — Название станции из справочника\n * @property {number} SORT\n * @property {string} UPPER - Название станции из справочника в верхнем регистре\n * @property {boolean} FLAG\n * @property {string} URL_ID\n * @property {string} FACET_VALUE\n * @property {number} ELEMENT_COUNT - Количество объектов с этой станцией\n **/\n/**\n * Описание станции из входных параметров компонента Vue (и из справочника АСАН)\n * @typedef AsanMetroStation\n * @type {object}\n * @property {numeric} ID ID станции в справочнике АСАН\n * @property {numeric} CITY_ID ID города в справочнике АСАН\n * @property {string} NAME Название станции\n * @property {number[]} LINE Идентификаторы веток, на которых находится станция\n * @property {string} SVG_ID ID элемента со станцией на карте (в svg)\n * @property {boolean} [isActive] Станция активна (кликабельна)\n * @property {boolean} [isStation] Используется для разделения станций и веток (@todo но ветки должны быть отдельно!?)\n * @property tippy ???\n * @property {SVGElement} mapGroup Элемент на карте\n **/\n/**\n * Описание станции из входных параметров компонента Vue (и из справочника АСАН)\n * @typedef AsanMetroLine\n * @type {object}\n * @property {numeric} ID ID ветки в справочнике АСАН\n * @property {numeric} CITY_ID ID города в справочнике АСАН\n * @property {string} NAME Название ветки\n * @property {string} SVG_ID ID элемента с веткой на карте (в svg)\n * @property {string} COLOR Цвет ветки (css)\n * @property {'Y'|'N'} IS_GROUP Является условной группой станций или официальной веткой?\n * @property {boolean} disable Ветка не активна (на ней нет активных стацний?)\n **/\n/**\n * @typedef MetroComponentViewModel\n * @type object\n * @property {AsanMetroStation[]} vm.stations - Станции из справочника АСАН\n * @property {AsanMetroLine[]} vm.lines - Линии (ветки) метро из справочника АСАН\n * @property {object} vm.lang - языковые фразы\n * @property {object} vm.popup - Всплывающие списки в поиске или селекте\n * @property {string} vm.searchText - Строка поиска\n * @property {array} vm.result - Результат выбора метро\n */\n\nlet vm;\n\nVue.component('metro', {\n    template: \"#metro-template\",\n    props: [\n        'stations',\n        'lines',\n        'lang',\n        // доступные для выбора станции из компонента bitrix:catalog.smart.filter (копируются в this.checkboxLocal, и обновляются ajax-ом через событие citrus-filter-start-json-load)\n        'checkbox',\n        // режим для разработки и тестирования корректности заполнения справочников и точек на карте\n        'debug',\n    ],\n    data: function () {\n        return {\n            popup: {\n                'metro-lines': false,\n                'metro-search-result': false\n            },\n            searchText: '',\n            maxSearchResult: 10,\n            searchHighlightIndex: -1,\n            selectedStations: [],\n            result: [],\n            backupResult: [],\n            activeTippy: {},\n            checkboxLocal: this.checkbox,\n\n            stationsMissingFromSvg: [],\n            stationsWithSeveralMatchingSvgIds: [],\n        }\n    },\n    created: function () {\n        vm = this;\n    },\n    computed: {\n        searchStations: function () {\n            if (!vm.searchText.length) return [];\n            var searchStations = vm.stations.filter(station => {\n                var stationName = station.NAME.toLowerCase();\n                return stationName.indexOf(vm.searchText.toLowerCase()) > -1 ||\n                    stationName.indexOf(vm.autoReplaceKeyboard(vm.searchText.toLowerCase())) > -1\n\n            });\n            if (searchStations.length > vm.maxSearchResult)\n                searchStations.splice(vm.maxSearchResult - 1, searchStations.length - vm.maxSearchResult);\n\n            return searchStations\n        },\n        activeSearchStations: function () {\n            return vm.searchStations.filter(station => station.isActive);\n        },\n        // если все станции ветки выбраны то выбираем ветку\n        // и удаляем из результата все станции ветки\n        formatResult: function () {\n            const checkedLineIds = [];\n            let result = [];\n            let excludeStations = [];\n\n            vm.result.forEach((station, resultKey) => {\n\n                station.LINE.forEach(lineId => {\n                    if (checkedLineIds.indexOf(lineId) > -1) return;\n\n                    checkedLineIds.push(lineId);\n\n                    const lineStation = vm.getStationsByLineId(lineId);\n                    const resultLineStation = vm.result.filter(function (station1) {\n                        return station1.LINE.indexOf(lineId) > -1 && station1.isActive;\n                    });\n                    if (lineStation.length === resultLineStation.length && lineStation.length >= 1) {\n                        result = result.concat(vm.getLinesById(lineId));\n                        excludeStations = excludeStations.concat(lineStation)\n                    }\n                });\n                if (excludeStations.indexOf(station) === -1) result.push(station);\n            });\n            return result;\n        },\n        activeStations: function () {\n            return vm.stations.filter(station => (vm.checkboxLocal.filter(cb => cb.VALUE === station.NAME && (!cb.DISABLED)).length > 0));\n        },\n        activeLines: function () {\n            return vm.lines.map(line => {\n                line.disable = (vm.getStationsByLineId(line.ID).length < 1);\n                return line;\n            });\n        },\n    },\n    methods: {\n        /**\n         * Добавляет активные станции на карту\n         * @param {object} item - станция или ветка\n         */\n        addToSvg: function (item) {\n            item = [].concat(item);\n            item.forEach(oneItem => {\n                if (oneItem.isStation) {\n                    $(oneItem.mapGroup).addClass('_active');\n                } else {\n                    // @todo мы тут можем оказаться? addToSvg не вызывается для веток (isStation === false)\n                    vm.addToSvg(vm.getStationsByLineId(oneItem.ID));\n                }\n            });\n        },\n        removeFromSvg: function (item) {\n            item = [].concat(item);\n            item.forEach(oneItem => {\n                if (oneItem.isStation) {\n                    $(oneItem.mapGroup).removeClass('_active');\n                } else {\n                    vm.removeFromSvg(vm.getStationsByLineId(oneItem.ID));\n                }\n            });\n        },\n\n        removeFromResult: function (arItems) {\n            arItems = [].concat(arItems);\n            arItems.forEach(oneItem => {\n                if (oneItem.isStation) {\n                    vm.removeFromSvg(oneItem);\n                    vm.$delete(vm.result, vm.result.indexOf(oneItem));\n                } else {\n                    let lineStations = vm.getStationsByLineId(oneItem.ID);\n                    // удаляются только станции которых нет в других выбранных ветках\n                    // (для станций в нескольких группах)\n                    // но станций должно быть больше 1\n                    lineStations = lineStations.filter(function (station) {\n                        var result = vm.formatResult.filter(function (resultLine) {\n                            return !resultLine.isStation &&\n                                resultLine.ID !== oneItem.ID &&\n                                (station.LINE.indexOf(resultLine.ID) > -1);\n                        });\n                        return result.length <= 1;\n                    });\n                    vm.removeFromResult(lineStations);\n                }\n            });\n        },\n        addToResult: function (arItems) {\n            arItems = [].concat(arItems);\n            arItems.forEach(oneItem => {\n                if (vm.inResult(oneItem)) return;\n                if (oneItem.isStation) {\n                    vm.result.unshift(oneItem);\n                    vm.addToSvg(oneItem);\n                } else {\n                    if (!oneItem.disable) vm.addToResult(vm.getStationsByLineId(oneItem.ID));\n                }\n            });\n        },\n        inResult: function (item) {\n            return vm.result.indexOf(item) > -1 || vm.formatResult.indexOf(item) > -1;\n        },\n        /**\n         * добавляет в результат\n         * @param {object} item - станция или ветка\n         */\n        toggleResult: function (item) {\n            vm[vm.inResult(item) ? 'removeFromResult' : 'addToResult'](item);\n        },\n\n        /* выбор станции из поиска */\n        onClickSearchResult: function (station, event) {\n            if (!station.isActive) {\n                if (vm.activeTippy.destroyAll) {\n                    vm.activeTippy.destroyAll();\n                    vm.activeTippy = {};\n                }\n\n                var o = event.target;\n                console.log('tippy', tippy);\n                station.tippy = vm.activeTippy = tippy(o, {\n                    placement: 'bottom-start',\n                    performance: true,\n                    trigger: 'custom',\n                    zIndex: 9999,\n                });\n                setTimeout(function () {\n                    o._tippy.show();\n                }, 0);\n                setTimeout(function () {\n                    station.tippy.destroyAll();\n                }, 1000);\n                return;\n            }\n\n            vm.searchText = '';\n            vm.searchHighlightIndex = -1;\n\n            if (typeof station !== 'undefined') vm.addToResult(station);\n        },\n        /**\n         * Изменение подвеченной в результатах поиска станции\n         *\n         * @param {number} index На какой количество позиций сместить порядковый номер (индекс) подсвеченной станции (+ или -)\n         */\n        highlightSearchResult: function (index) {\n            var resultLength = vm.activeSearchStations.length;\n\n            if (!resultLength) return;\n\n            var startSearchIndex = vm.searchHighlightIndex;\n            vm.searchHighlightIndex += index;\n\n            if (index < 0 && startSearchIndex === -1) {\n                vm.searchHighlightIndex = resultLength - 1;\n            }\n\n            if (vm.searchHighlightIndex > resultLength) vm.searchHighlightIndex = -1;\n            if (vm.searchHighlightIndex < -1) vm.searchHighlightIndex = -1;\n        },\n        /**\n         * Выбор станции, подсвеченной в результатах поиска или единственной в результатах поиска\n         */\n        clickHighlightResultItem: function () {\n            vm.onClickSearchResult(vm.activeSearchStations.length === 1 ?\n                vm.activeSearchStations[0] : vm.activeSearchStations[vm.searchHighlightIndex]);\n        },\n\n        getLinesById: function (arId) {\n            arId = [].concat(arId);\n            return vm.lines.filter(line => arId.indexOf(line.ID) > -1);\n        },\n        getStationsByLineId: function (lineId) {\n            return vm.activeStations.filter(station => station.LINE.indexOf(lineId) > -1);\n        },\n\n        togglePopup: function (popupName) {\n            vm.popup[popupName] = !vm.popup[popupName];\n        },\n        openPopup: function (popupName) {\n            vm.popup[popupName] = true;\n        },\n        hidePopup: function (popupName) {\n            vm.popup[popupName] = false;\n        },\n\n        saveBackUpResult: function () {\n            vm.backupResult = vm.result.reduce((ar, resultItem) => {\n                ar.push(resultItem);\n                return ar;\n            }, []);\n        },\n        resetResult: function () {\n            vm.removeFromResult(vm.result);\n            vm.addToResult(vm.backupResult);\n        },\n        saveResult: function () {\n            vm.saveBackUpResult();\n            $.magnificPopup.close();\n            smartFilter.updateDuplicate();\n            smartFilter.reload();\n        },\n\n        inResultStationName: function (stationName) {\n            return (vm.result.filter(resultItem => resultItem.NAME === stationName).length > 0);\n        },\n\n        autoReplaceKeyboard: function (str) {\n            var replacer = vm.lang['AUTO_REPLACE_EN_RU'];\n\n            return str.replace(/[A-z/,.;\\'\\]\\[]/g, function (x) {\n                return x == x.toLowerCase() ? replacer[x] : replacer[x.toLowerCase()].toUpperCase();\n            });\n        },\n        getStationsByName: function (name) {\n            return vm.stations.filter(station => station.NAME === name);\n        },\n        /**\n         * Инициализация точки станции на svg карты\n         *\n         * @param {AsanMetroStation} station\n         **/\n        processStation: function (station) {\n            station.isActive = !!this.debug || (vm.checkboxLocal.filter(function (cb) {\n                return (cb.VALUE === station.NAME) && (!cb.DISABLED);\n            }).length > 0);\n\n            var $mapGroup = $(vm.$map).find(`#${station.SVG_ID}`);\n            station.mapGroup = $mapGroup.get(0);\n            if (vm.debug) {\n                if ($mapGroup.length <= 0) {\n                    vm.stationsMissingFromSvg.push(Object.assign ({}, station));\n                } else if ($mapGroup.length > 1) {\n                    vm.stationsWithSeveralMatchingSvgIds.push(Object.assign ({}, station));\n                } else if (station.mapGroup) {\n                    const nameInRef = station.NAME.replace(`ё`, `е`);\n                    const nameOnMap = station.mapGroup.textContent.trim().replace(/\\s+/g, ' ').replace(`ё`, `е`);\n                    if (nameOnMap.toUpperCase().replace(/\\s+/g, '') !== nameInRef.toUpperCase().replace(/\\s+/g, '')) {\n                        console.warn(`Название станции из справочника (${nameInRef}) не совпадает с названием на карте (${nameOnMap})`, station.mapGroup);\n                    }\n                }\n            }\n            if (station.isActive)\n                $mapGroup.addClass('_clickable');\n            else\n                $mapGroup.removeClass('_clickable');\n            $mapGroup.find('text').addClass('metro-map-name');\n\n            return station;\n        }\n    },\n    mounted: function () {\n        cui.clickOff($(vm.$refs.popupLinesLabel).add($(vm.$refs.popupLines)), () => {\n            vm.hidePopup('metro-lines');\n        });\n\n        cui.clickOff($(vm.$refs.searchInput).add($(vm.$refs.searchResult)), () => {\n            vm.hidePopup('metro-search-result');\n        });\n\n        /** элемент с svg карты */\n        vm.$map = $('#metro-map-container');\n\n        // привязка станций к точкам из справочника\n        Vue.nextTick(() => {\n            if (vm.debug) {\n                console.info(`Станции из справочника (vm.stations)`, vm.stations);\n                console.log(`Станции доступные для выбора в фильтре (vm.checkboxLocal)`, vm.checkboxLocal);\n            }\n        });\n        vm.stations.map(station => {\n            vm.processStation(station);\n\n            station.isStation = true;\n            $(station.mapGroup)\n                .addClass('metro-map-group')\n                .on('click', function (event) {\n                    if (station.isActive) vm.toggleResult(station);\n                });\n            var grouppedStations = $(station.mapGroup).find('g');\n            var $stationGroup = grouppedStations.length ?\n                grouppedStations : $(station.mapGroup);\n            $stationGroup.each(function () {\n                $(this).find('circle,ellipse').last().addClass('metro-map-point');\n            });\n\n            return station;\n        });\n        Vue.nextTick(() => {\n            if (vm.debug) {\n                if (vm.stationsMissingFromSvg.length) {\n                    console.warn(`В справочнике найдены станции, которых нет в svg (vm.stationsMissingFromSvg)`);\n                    console.table(vm.stationsMissingFromSvg.map(o => JSON.parse(JSON.stringify(o))));\n                }\n                if (vm.stationsWithSeveralMatchingSvgIds.length) {\n                    console.warn(`В справочнике найдены станции, для которых на карте есть несколько подходящих идентификаторов (vm.stationsWithSeveralMatchingSvgIds)`)\n                    console.table(vm.stationsWithSeveralMatchingSvgIds.map(o => JSON.parse(JSON.stringify(o))));\n                }\n\n                const idsOnMap = [...vm.$map.get(0).querySelectorAll('[id]')].map(function (el) {\n                        return el.id;\n                    }),\n                    allIdsCount = idsOnMap.length,\n                    removeFromIdsOnMap = function (item) {\n                        var idx = idsOnMap.findIndex(id => id === item.SVG_ID);\n                        if (idx >= 0) {\n                            idsOnMap.splice(idx, 1);\n                        }\n                    };\n\n                vm.stations.forEach(removeFromIdsOnMap);\n                vm.lines.forEach(removeFromIdsOnMap);\n\n                if (idsOnMap.length) {\n                    console.log(`Всего идентификаторов в svg: ${allIdsCount}, из них не относится к станциям и веткам: ${idsOnMap.length}`, idsOnMap);\n                }\n            }\n        });\n\n        // сортируем станции по активности\n        vm.stations.sort((a, b) => b.isActive - a.isActive);\n\n        vm.checkboxLocal.forEach(cb => {\n            if (cb.CHECKED) {\n                vm.addToResult(vm.getStationsByName(cb.VALUE));\n            }\n        });\n\n        $(this.$refs.checkbox).on('change', function () {\n            vm[$(this).prop('checked') ? 'addToResult' : 'removeFromResult'](vm.getStationsByName($(this).data('name')));\n        });\n\n        vm.saveBackUpResult();\n\n        // обновлениие станций после того, как с сервера пришло новое сотояние умного фильтра\n        BX.addCustomEvent('citrus-filter-start-json-load', function (params) {\n            let metroValues;\n            for (const i in params.ITEMS) {\n                if (params.ITEMS[i].CODE == 'metro_stations') {\n                    metroValues = Object.values(params.ITEMS[i].VALUES);\n                    break;\n                }\n            }\n            if (metroValues) {\n                /** @param checkboxLocal {SmartFilterStationCheckbox[]} Доступные для выбора станции из компонента bitrix:catalog.smart.filter */\n                vm.checkboxLocal = metroValues;\n                vm.stations.map(vm.processStation);\n            }\n        });\n    },\n});\n\nwindow.SMARTFILTER_LOCATION = function (id) {\n    var $label = $('#filter-label-' + id);\n\n    //popup\n    $label.on('click', event => {\n        event.preventDefault();\n        $.magnificPopup.open({\n            items: {\n                src: '#filter-values-' + id\n            },\n            type: 'inline',\n            midClick: true,\n            callbacks: {\n                'close': function () {\n                    vm.resetResult();\n                },\n            }\n        });\n    });\n};\n"],"names":["vm","Vue","component","template","props","data","popup","searchText","maxSearchResult","searchHighlightIndex","selectedStations","result","backupResult","activeTippy","checkboxLocal","checkbox","stationsMissingFromSvg","stationsWithSeveralMatchingSvgIds","created","computed","searchStations","length","stations","filter","station","stationName","NAME","toLowerCase","indexOf","autoReplaceKeyboard","splice","activeSearchStations","isActive","formatResult","checkedLineIds","excludeStations","forEach","resultKey","LINE","lineId","push","lineStation","getStationsByLineId","resultLineStation","station1","concat","getLinesById","activeStations","cb","VALUE","DISABLED","activeLines","lines","map","line","disable","ID","methods","addToSvg","item","oneItem","isStation","$","mapGroup","addClass","removeFromSvg","removeClass","removeFromResult","arItems","$delete","lineStations","resultLine","addToResult","inResult","unshift","toggleResult","onClickSearchResult","event","destroyAll","o","target","console","log","tippy","placement","performance","trigger","zIndex","setTimeout","_tippy","show","highlightSearchResult","index","resultLength","startSearchIndex","clickHighlightResultItem","arId","togglePopup","popupName","openPopup","hidePopup","saveBackUpResult","reduce","ar","resultItem","resetResult","saveResult","magnificPopup","close","smartFilter","updateDuplicate","reload","inResultStationName","str","replacer","lang","replace","x","toUpperCase","getStationsByName","name","processStation","debug","$mapGroup","$map","find","SVG_ID","get","Object","assign","nameInRef","nameOnMap","textContent","trim","warn","mounted","cui","clickOff","$refs","popupLinesLabel","add","popupLines","searchInput","searchResult","nextTick","info","on","grouppedStations","$stationGroup","each","last","table","JSON","parse","stringify","idsOnMap","querySelectorAll","el","id","allIdsCount","removeFromIdsOnMap","idx","findIndex","sort","a","b","CHECKED","prop","BX","addCustomEvent","params","metroValues","i","ITEMS","CODE","values","VALUES","window","SMARTFILTER_LOCATION","$label","preventDefault","open","items","src","type","midClick","callbacks"],"mappings":"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"}