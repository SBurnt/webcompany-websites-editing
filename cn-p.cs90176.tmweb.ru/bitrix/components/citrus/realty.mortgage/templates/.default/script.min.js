!function(e){e.fn.citrusRealtyMortgage=function(r){function t(e,r){r=d.find("."+e+"-val").hasClass("input-percent")?o.to(r):v.to(r),d.find("."+e+"-val").val(r)}function i(e,r,t,i,a){var n=1;0!=a&&("full-price"==e||"first-price"==e)&&(n=5e4),d.find("."+e).slider({value:r,min:t,max:i,range:"max",step:n,slide:function(r,t){var i=t.value;e.indexOf("percent")>=0&&(i/=10),f(e,i,!0)}})}function a(){var r=s("full-price"),t=s("first-price"),i=s("percent"),a=s("years");d.find(".years-val")[0].nextSibling.nodeValue=" "+c(a,BX.message("citrus.year.titles").split("|"));var n=r-t,l=i/1200,f=n*(l+l/(Math.pow(1+l,12*a)-1)),p=f*a*12-n,o=(i-u.discountPercent)/1200,P=n*(o+o/(Math.pow(1+o,12*a)-1)),F=P*a*12-n;d.find(".monthly-payment").text(m.to(f)),d.find(".overpayment").text(v.to(p)),d.find(".economy").text(m.to(p-F)).parents(".result-row").toggle(p-F>0);var x=e("#PREVIEW_TEXT"),h=x.val()||"---\n",y=h.replace(/---\n[\S\s]*/m,"---\n");d.find(".service-form-row").each(function(){var r=e(this).find("label").text(),t=e(this).find("input");r&&(y+=r+" "+t.val()+" "+t[0].nextSibling.nodeValue.trim(),t.hasClass("first-price-val")&&(y+=" ("+s("first-percent")+"%)"),y+="\n")}),x.val(y.trim())}function n(){d.find(".full-price-val").val(v.to(parseInt(u.defaultFullPrice))),d.find(".first-price-val").val(v.to(parseInt(u.defaultFirstPrice))),d.find(".first-percent-val").val(o.to(parseFloat(u.defaultFirstPercent))),d.find(".percent-val").val(o.to(parseFloat(u.defaultPercent))),d.find(".years-val").val(u.defaultYear)}function l(){var e=d.find(".full-price-val").val();e=e.replace(/[^\d,]/g,""),d.find(".full-price-val").val(v.to(parseInt(e)));var r=d.find(".first-price-val").val();r=r.replace(/[^\d,]/g,""),d.find(".first-price-val").val(v.to(parseInt(r)));var t=d.find(".first-percent-val").val();t=t.replace(/[,]/g,"."),t=t.replace(/[^\d.]/g,""),d.find(".first-percent-val").val(o.to(parseFloat(t)));var i=d.find(".percent-val").val();i=i.replace(/[,]/g,"."),i=i.replace(/[^\d.]/g,""),d.find(".percent-val").val(o.to(parseFloat(i)));var a=d.find(".years-val").val();a=a.replace(/[^\d]/g,""),d.find(".years-val").val(a)}function c(e,r){var t=[2,0,1,1,1,2];return r[e%100>4&&20>e%100?2:t[Math.min(e%10,5)]]}function s(e){switch(e){case"full-price":case"first-price":case"first-percent":case"percent":case"years":return e.indexOf("percent")>=0?parseFloat(o.from(d.find("."+e+"-val").val())):parseInt(v.from(d.find("."+e+"-val").val()));default:return console.error('Invalid "which" argument: ',e),null}}function f(e,r,n){var l,c,f,p;switch(n=n||!1,e){case"full-price":i("full-price",r,u.minFullPrice,u.maxFullPrice),"R"==u.defaultFirstPriceUnits?(l=s("first-price"),i("first-price",l,0,r*u.maxFirstPercent/100),t("first-price",l),i("first-percent",l/r*100*10,10*u.minFirstPercent,10*u.maxFirstPercent),t("first-percent",l/r*100)):(c=s("first-percent"),f=c*r/100,i("first-price",f,0,r*u.maxFirstPercent/100),t("first-price",f));break;case"first-price":"R"==u.defaultFirstPriceUnits?(p=r/s("full-price")*100,i("first-price",r,u.minFirstPrice,s("full-price")*u.maxFirstPercent/100),i("first-percent",10*p,10*u.minFirstPercent,10*u.maxFirstPercent),t("first-percent",p)):(p=100*r/s("full-price"),i("first-percent",p,u.minFirstPercent,u.maxFirstPercent),t("first-percent",p));break;case"first-percent":f=s("full-price")*r/100,i("first-percent",r,10*u.minFirstPercent,10*u.maxFirstPercent),i("first-price",f,u.minFirstPrice,s("full-price")*u.maxFirstPercent/100,!1),t("first-price",f);break;case"percent":i("percent",r,10*u.minPercent,10*u.maxPercent);break;case"years":i("years",r,u.minYear,u.maxYear);break;default:console.error('Invalid "where" argument: ',e)}n&&t(e,r),a()}function p(e){l();var r=parseInt(v.from(e.val()));e.hasClass("full-price-val")?f("full-price",r):e.hasClass("first-price-val")?f("first-price",r):e.hasClass("first-percent-val")?f("first-percent",r):e.hasClass("percent-val")?f("percent",r):e.hasClass("years-val")&&f("years",r)}var u=e.extend({minFullPrice:5e5,maxFullPrice:3e7,defaultFullPrice:3e6,minFirstPrice:0,defaultFirstPrice:45e4,defaultFirstPriceUnits:"R",minFirstPercent:0,maxFirstPercent:70,minPercent:1,maxPercent:30,defaultPercent:11.5,minYear:1,maxYear:50,defaultYear:15,defaultFirstPercent:null,discountPercent:.5},r),d=this;u.defaultFirstPercent=u.defaultFirstPrice/u.defaultFullPrice*100;var v=wNumb({decimals:0,thousand:" ",mark:"."}),m=wNumb({decimals:2,thousand:" ",mark:","}),o=wNumb({decimals:1,thousand:"",mark:","});n(),i("full-price",u.defaultFullPrice,u.minFullPrice,u.maxFullPrice),i("first-price",u.defaultFirstPrice,u.minFirstPrice,u.defaultFullPrice*u.maxFirstPercent/100),i("first-percent",10*u.defaultFirstPercent,10*u.minFirstPercent,10*u.maxFirstPercent),i("percent",10*u.defaultPercent,10*u.minPercent,10*u.maxPercent),i("years",u.defaultYear,u.minYear,u.maxYear),a(),d.find("input").blur(function(){p(e(this))}).keyup(function(r){13==r.keyCode&&e(this).blur()})}}(jQuery);